<<<<<<< SEARCH
class AppDiscovery: ObservableObject {
    @Published var runningApps: [AppInfo] = []
    private var cancellables = Set<AnyCancellable>()

    struct AppInfo: Identifiable, Hashable {
=======
class AppDiscovery: ObservableObject {
    @Published var runningApps: [AppInfo] = []
    private var cancellables = Set<AnyCancellable>()
    private let updateQueue = DispatchQueue(label: "com.holdr.appDiscovery.updateQueue", qos: .userInitiated)

    struct AppInfo: Identifiable, Hashable {
>>>>>>> REPLACE
<<<<<<< SEARCH
    private func updateRunningApps() {
        let apps = NSWorkspace.shared.runningApplications
            .filter { -bash.activationPolicy == .regular } // Only normal apps (with Dock icon)
            .sorted { (-bash.localizedName ?? "") < (.localizedName ?? "") }

        let appInfos = apps.compactMap { app -> AppInfo? in
            guard let bundleID = app.bundleIdentifier,
                  let name = app.localizedName,
                  let icon = app.icon else { return nil }
            return AppInfo(bundleID: bundleID, name: name, icon: icon)
        }

        // Dedup by bundle ID
        let unique = Array(Set(appInfos)).sorted { -bash.name < .name }

        DispatchQueue.main.async {
            self.runningApps = unique
        }
    }
}
=======
    private func updateRunningApps() {
        updateQueue.async { [weak self] in
            let apps = NSWorkspace.shared.runningApplications
                .filter { -bash.activationPolicy == .regular } // Only normal apps (with Dock icon)
                .sorted { (-bash.localizedName ?? "") < (.localizedName ?? "") }

            let appInfos = apps.compactMap { app -> AppInfo? in
                guard let bundleID = app.bundleIdentifier,
                      let name = app.localizedName,
                      let icon = app.icon else { return nil }
                return AppInfo(bundleID: bundleID, name: name, icon: icon)
            }

            // Dedup by bundle ID
            let unique = Array(Set(appInfos)).sorted { -bash.name < .name }

            DispatchQueue.main.async {
                self?.runningApps = unique
            }
        }
    }
}
>>>>>>> REPLACE
